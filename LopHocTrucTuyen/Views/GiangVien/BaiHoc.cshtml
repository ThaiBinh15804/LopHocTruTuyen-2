@using LopHocTrucTuyen.Models;

@model LopHocTrucTuyen.Models.KhoaHoc

<script src="~/Scripts/jquery-1.8.2.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h3>@Model.TenKhoaHoc</h3>  @* Hiển thị tên khoá học *@

            @* Hiển thị các chương hiện có *@
            <div id="chuongContainer">
                @{
                    List<Chuong> chuongs = Model.Chuongs.OrderBy(t => t.ThuTu).ToList();
                    foreach (Chuong chuong in chuongs)
                    {
                        <div class="accordion mb-2" id="accordion_@chuong.MaChuong">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading_@chuong.MaChuong">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_@chuong.MaChuong">
                                        @chuong.TenChuong
                                    </button>
                                </h2>
                                <div id="collapse_@chuong.MaChuong" class="accordion-collapse collapse" data-bs-parent="#accordion_@chuong.MaChuong">
                                    <div class="accordion-body">
                                        <div class="py-2 px-1 mb-2" style="font-style:italic;">
                                            <p>"@chuong.MoTa"</p>
                                        </div>

                                        <div class="my-3 d-flex justify-content-end">
                                            <a href="/GiangVien/SuaChuong/?machuong=@chuong.MaChuong" class="btn btn-info btn-sm mx-2">Chỉnh sửa chương</a>

                                            <a href="/GiangVien/XoaChuong/?machuong=@chuong.MaChuong" class="btn btn-danger btn-sm">Xoá chương</a>
                                        </div>

                                        <ul class="list-unstyled">
                                            @{
                                                List<BaiGiang> baigiangs = chuong.BaiGiangs.OrderBy(t => t.ThuTu).ToList();
                                                foreach (BaiGiang baiHoc in baigiangs)
                                                {
                                                    <li class="border rounded-1 px-3 py-2 mb-2 d-flex justify-content-between align-items-center">
                                                        <!-- Tên bài học ở đầu -->
                                                        <span>@baiHoc.TenBaiGiang</span>
    
                                                        <!-- Nhóm các nút ở cuối thẻ li -->
                                                        <div class="d-flex gap-2">
                                                            <a class="btn btn-outline-secondary btn-sm" href="@Url.Action("EditBaiHoc", new { id = baiHoc.MaBaiGiang })">Chỉnh sửa chi tiết</a>
                                                            <a class="btn btn-outline-danger btn-sm" href="@Url.Action("DeleteBaiHoc", new { id = baiHoc.MaBaiGiang })">Xoá</a>
                                                        </div>
                                                    </li>

                                                }
                                            }
                                        </ul>

                                        @* Nút tạo bài học mới cho chương *@
                                        <button class="btn btn-primary btn-sm" id="ThemBaiHoc_@chuong.MaChuong" onclick="showAddBaiHocForm(@chuong.MaChuong)">Thêm Bài học</button>

                                        @* Form thêm bài học *@
                                        <div id="formAddBaiHoc_@chuong.MaChuong" class="mt-2" style="display: none;">
                                            <input type="text" id="baiHocName_@chuong.MaChuong" class="form-control" placeholder="Tên Bài học" required />
                                            <button onclick="addBaiHoc(@chuong.MaChuong)" class="btn btn-success btn-sm mt-1">Tạo</button>
                                            <button class="btn btn-secondary btn-sm mt-1" onclick="hideAddBaiHocForm(@chuong.MaChuong)">Huỷ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>

    @* Nút tạo chương mới *@
    <div class="row">
        <div class="col-12">
            <div class="form-control mt-3" id="addChuongForm" style="display: none;">
                <form action="/GiangVien/TaoChuong/?makh=@Model.MaKhoaHoc" method="post">
                    <input type="text" name="TenChuong" class="form-control" placeholder="Tên Chương" required />
                    <input type="hidden" name="ThuTu" value="@Model.Chuongs.Count" />
                    <textarea name="MoTa" class="form-control mt-2" placeholder="Mô tả của chương ... (Giới hạn 255 kí tự)" rows="3"></textarea>
                    <div class="mt-2"> 
                        <button class="btn btn-dark mr-3" type="submit">Tạo Chương</button>
                        <button class="btn btn-secondary" type="button" onclick="cancelAddChuong()">Huỷ</button>
                    </div>
                </form>
            </div>


        </div>
    </div>

    @* Nút thêm chương *@
    <!-- Nút thêm chương -->
    <button class="btn btn-success my-3 px-3 py-2"
            id="ThemChuong"
            onclick="showAddChuongForm()">
        Thêm chương
    </button>


</div>

<script>
    function showAddChuongForm() {
        document.getElementById("addChuongForm").style.display = "block";
        document.getElementById("ThemChuong").style.display = "none";
    }

    function cancelAddChuong() {
        document.getElementById("addChuongForm").style.display = "none";
        document.getElementById("ThemChuong").style.display = "inline-block";
    }

    function showAddBaiHocForm(chuongId) {
        document.getElementById('formAddBaiHoc_' + chuongId).style.display = 'block';
        document.getElementById('ThemBaiHoc_' + chuongId).style.display = 'none';
    }

    function hideAddBaiHocForm(chuongId) {
        document.getElementById('formAddBaiHoc_' + chuongId).style.display = 'none';
        document.getElementById('ThemBaiHoc_' + chuongId).style.display = 'block';
    }

    function addBaiHoc(chuongId) {
        const baiHocName = document.getElementById('baiHocName_' + chuongId).value;
    
    }
</script>
